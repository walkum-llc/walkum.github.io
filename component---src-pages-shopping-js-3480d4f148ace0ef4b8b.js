"use strict";(self.webpackChunkwalkum=self.webpackChunkwalkum||[]).push([[87],{4457:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var r={};n.r(r),n.d(r,{b:function(){return c},V:function(){return l},$1:function(){return s},AS:function(){return i},tv:function(){return u},_R:function(){return d},jE:function(){return m},DT:function(){return p}});var a=n(6540),o=n(1468),c="shopping-module--closeButton--fdfa2",l="shopping-module--fullScreenImage--3e206",s="shopping-module--fullScreenModal--d5a88",i="shopping-module--item--7b82f",u="shopping-module--itemImage--78d3d",d="shopping-module--itemList--d6d43",m="shopping-module--modalContent--12e4c",p="shopping-module--removeButton--04c91",E=n(9446);var h=e=>{let{quantity:t,stock:n,onDecrease:r,onIncrease:o}=e;return a.createElement("div",null,a.createElement("button",{onClick:e=>{e.stopPropagation(),r()}},"-"),a.createElement("span",null,"   ",t,"   "),a.createElement("button",{onClick:e=>{e.stopPropagation(),o()}},"+"))};var y=e=>{let{item:t,onClose:n,handleToggle:r,handleQuantityChange:o,isInCart:i,cart:u}=e;const d=u.find((e=>e.id===t.id)),{0:E,1:y}=(0,a.useState)(d?d.quantity:1);(0,a.useEffect)((()=>{d&&y(d.quantity)}),[d]);const f=e=>{const n=Math.min(Math.max(e,1),t.stock);y(n),o(t,n)};return(0,a.useEffect)((()=>{const e=e=>{"Escape"===e.key&&n()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[n]),a.createElement("div",{className:s,onClick:n},a.createElement("div",{className:m,onClick:e=>e.stopPropagation()},a.createElement("button",{className:c,onClick:n},"Ã— Close"),a.createElement("img",{src:t.image,alt:t.name,className:l}),a.createElement("h3",null,t.name),a.createElement("p",null,t.description),a.createElement("p",null,"Price: $",t.price),a.createElement("p",null,"Stock: ",t.stock),i(t.id)&&a.createElement("div",null,a.createElement("label",{htmlFor:"quantityInput"},"Quantity: "),a.createElement(h,{quantity:E,stock:t.stock,onDecrease:()=>f(E-1),onIncrease:()=>f(E+1)})),a.createElement("button",{onClick:()=>r(t),className:i(t.id)?p:"",disabled:t.stock<=0},i(t.id)?"Remove from Cart":"Add to Cart")))};var f=()=>{const e=(0,o.wA)(),t=(0,o.d4)(E.VH),n=(0,o.d4)((e=>e.onlineStore.storeItems)),{0:r,1:c}=(0,a.useState)(null),{0:l,1:s}=(0,a.useState)(!1);(0,a.useEffect)((()=>{const e=()=>{const e=document.querySelector("."+d);if(e){const t=getComputedStyle(e).getPropertyValue("grid-template-columns");s(1===t.split(" ").length)}};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]);const m=t=>{e((0,E.ZT)(t))},f=(t,n)=>{e((0,E._V)({id:t.id,quantity:n}))},v=e=>t.some((t=>t.id===e));return a.createElement("div",{className:d},n.map(((e,n)=>{const r=t.find((t=>t.id===e.id)),o=r?r.quantity:1;return a.createElement("div",{key:n,className:i,onClick:()=>(e=>{l||c(e)})(e)},a.createElement("img",{src:e.image,alt:e.name,className:u,width:100,height:100}),a.createElement("h3",null,e.name),a.createElement("p",null,e.description),a.createElement("p",null,"$",e.price),a.createElement("p",null,"# Remaining: ",e.stock),v(e.id)?a.createElement("button",{onClick:t=>{t.stopPropagation(),m(e)},className:p},"Remove from Cart"):a.createElement("button",{onClick:t=>{t.stopPropagation(),m(e)},disabled:e.stock<=0},"Add to Cart"),v(e.id)&&a.createElement(h,{quantity:o,stock:e.stock,onDecrease:()=>f(e,Math.max(1,o-1)),onIncrease:()=>f(e,Math.min(e.stock,o+1))}))})),!l&&r&&a.createElement(y,{item:r,onClose:()=>{c(null)},handleToggle:m,handleQuantityChange:f,cart:t,isInCart:v}))};var v=e=>{let{cart:t,paypalRef:n,onApprove:r,createOrder:o}=e;const c=(0,a.useRef)(!1);(0,a.useEffect)((()=>{if(c.current)return void console.log("PayPal buttons already rendered. Skipping initialization.");const e=document.createElement("script");return e.src="https://www.paypal.com/sdk/js?client-id=AUxuYrgxn1s8KfOGOEv_xX5q5vaoBdh6E5mc4vvKYFHkSUmK3rucl_jhhyNUuov3NRDrJboQIEvpQu97&buyer-country=US&currency=USD&components=buttons&enable-funding=venmo,paylater,card",e.async=!0,e.onload=()=>{window.paypal&&n.current&&(c.current=!0,window.paypal.Buttons({style:{shape:"rect",layout:"vertical",color:"gold",label:"paypal"},createOrder:o,onApprove:r}).render(n.current))},document.body.appendChild(e),()=>{c.current&&(console.log("Cleaning up PayPal buttons."),c.current=!1),document.body.contains(e)&&document.body.removeChild(e)}}),[t,n,o,r])};var g=e=>{let{cart:t}=e;const n=(0,o.wA)(),r=(0,a.useRef)(null);return v({cart:t,paypalRef:r,createOrder:async(e,n)=>{try{t.reduce(((e,t)=>e+parseFloat(t.price)*t.quantity),0).toFixed(2);const e=await fetch("http://localhost:8080/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cart:t})}),n=await e.json();if(console.log("createOrder Response:",n),n.id)return n.id;throw new Error("Failed to create order")}catch(r){throw console.error("createOrder Error:",r),new Error("Could not initiate PayPal Checkout")}},onApprove:async(e,t)=>{try{var r,a,o,c;const t=await fetch("http://localhost:8080/api/orders/"+e.orderID+"/capture",{method:"POST",headers:{"Content-Type":"application/json"}}),d=await t.json();if(console.log("onApprove Response:",d),null==d||null===(r=d.purchase_units)||void 0===r||null===(a=r[0])||void 0===a||null===(o=a.payments)||void 0===o||null===(c=o.captures)||void 0===c||!c[0])throw new Error("Capture failed");{var l,s,i,u;const e=null==d||null===(l=d.purchase_units)||void 0===l||null===(s=l[0])||void 0===s||null===(i=s.payments)||void 0===i||null===(u=i.captures)||void 0===u?void 0:u[0];console.log("Transaction completed:",e),n((0,E.sX)())}}catch(d){console.error("onApprove Error:",d),alert("Sorry, your transaction could not be processed.")}}}),a.createElement("div",null,a.createElement("div",{ref:r}),a.createElement("button",{onClick:()=>(async e=>{let{cart:t,dispatch:n,clearCart:r}=e;try{const e=await fetch("http://localhost:8080/api/mock-purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cart:t})}),a=await e.json();if(console.log("Mock Purchase Response:",a),!a.success)throw new Error("Mock purchase failed");n(r()),alert("Mock purchase succeeded!")}catch(a){console.error("Mock Purchase Error:",a),alert("Mock purchase failed. Check console for details.")}})({cart:t,dispatch:n,clearCart:E.sX}),className:"index-module--mockButton--c6f84"},"Mock Purchase"))};var k=()=>{const e=(0,o.wA)(),t=(0,o.d4)(E.VH),n=(t,n)=>{const r=Math.max(1,Math.min(n,t.stock));e((0,E._V)({id:t.id,quantity:r}))};return t&&0!==t.length?a.createElement("div",{className:r.cart},a.createElement("h2",null,"Your Cart"),a.createElement("table",{className:r.cartTable},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Item"),a.createElement("th",null,"Price"),a.createElement("th",null,"Quantity"),a.createElement("th",null,"Total"),a.createElement("th",null,"Remove"))),a.createElement("tbody",null,t.map(((t,r)=>{const o=Number(t.price)||0,c=Number(t.quantity)||0,l=o*c;return a.createElement("tr",{key:r},a.createElement("td",null,t.name||"Unnamed Item"),a.createElement("td",null,"$",o.toFixed(2)),a.createElement("td",null,a.createElement(h,{quantity:c,stock:t.stock,onDecrease:()=>n(t,Math.max(1,c-1)),onIncrease:()=>n(t,Math.min(t.stock,c+1))})),a.createElement("td",null,"$",l.toFixed(2)),a.createElement("td",null,a.createElement("button",{onClick:()=>(t=>{e((0,E.ZT)(t))})(t),className:p},"Remove")))})))),a.createElement("h3",{className:r.grandTotal},"Grand Total: $",t.reduce(((e,t)=>e+(Number(t.price)||0)*(Number(t.quantity)||0)),0).toFixed(2)),a.createElement(g,{cart:t})):a.createElement("p",{className:r.emptyCartMessage},"Your cart is empty!")},C=n(8272);const w=e=>{const t=e.trim().split("\n"),n=t.shift().split(",").map((e=>e.replace(/(^"|"$)/g,"")));return t.map((e=>{const t=e.split(",").map((e=>e.replace(/(^"|"$)/g,""))),r={};return n.forEach(((e,n)=>{e&&(r[e]=t[n]||null)})),r}))};var S=()=>{const e=(0,o.wA)(),t=(0,o.d4)(E.dX);(0,a.useEffect)((()=>{(async()=>{const t=await(async e=>{const t="https://docs.google.com/spreadsheets/d/"+C.SPREADSHEET_ID_PRODUCTS+"/gviz/tq?tqx=out:csv&sheet="+e;try{const e=await fetch(t);if(!e.ok)throw new Error("HTTP error! status: "+e.status);const n=await e.text();return w(n)}catch(n){return console.error('Error fetching spreadsheet data from sheet "'+e+'":',n),[]}})(C.PRODUCTS_SHEETNAME);e((0,E.Bl)(t)),e((0,E.q_)())})()}),[e]);return a.createElement("div",null,a.createElement("h1",null,"Shopping Page"),a.createElement("button",{className:r.cartToggleButton,onClick:()=>{e((0,E.ss)())}},t?"Hide Cart":"View Cart"),t&&a.createElement(k,null),a.createElement("div",{className:r.itemListContainer},a.createElement(f,null)))};var b=()=>a.createElement(S,null)},8272:function(e){e.exports=JSON.parse('{"SPREADSHEET_ID_TEST":"1rUtUHdS0XIH33zkqyGI7E1FHHVkP18EwKbm335EcUuU","SPREADSHEET_ID_SOURPATCHBAKERY":"1HHIb_HfGZ3Ui8GBTTJ4DplXtpVW-9BwHSwmchVNSiIA","SPREADSHEET_ID_RESTAURANT":"1OHQbtAt5JqttftgnGd3PVNaR44vbqjb3tcxluLHXIa8","SPREADSHEET_ID_PRODUCTS":"1Y825bTozBNpQFz3rZNCtHkACbSbOO9W48L3_01QuLQY","PRODUCTS_SHEETNAME":"products"}')}}]);
//# sourceMappingURL=component---src-pages-shopping-js-3480d4f148ace0ef4b8b.js.map